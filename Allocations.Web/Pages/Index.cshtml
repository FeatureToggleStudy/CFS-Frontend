@page
@using ApiClient
@inject AllocationsApiClient ApiClient;
@{
    ViewData["Title"] = "Home page";
}


@functions
{
    public BudgetSummary[] Budgets { get; set; }
    public async Task OnGetAsync()
    {
        Budgets = (await ApiClient.GetAsync<BudgetSummary[]>("api/v1/results/budgets/"))?.Content;
    }
}

@foreach (var budget in Budgets)
{
    <h1>@budget.Budget.Name</h1>
    <p>Total @budget.TotalAmount.ToString("C")</p>
    <p>@budget.TestSummary.Failed providers failing tests</p>
    foreach (var fundingPolicySummary in budget.FundingPolicies)
    {
        <h2>@fundingPolicySummary.FundingPolicy.Name</h2>
        <p>Total @fundingPolicySummary.TotalAmount.ToString("C")</p>
        <p>@fundingPolicySummary.TestSummary.Failed providers failing tests</p>

    }

}
