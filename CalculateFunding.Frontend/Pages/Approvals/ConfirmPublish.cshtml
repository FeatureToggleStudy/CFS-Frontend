@page
@model CalculateFunding.Frontend.Pages.Approvals.ConfirmPublishModel
@using CalculateFunding.Frontend.Extensions
@using CalculateFunding.Frontend.Properties
@{
    ViewData["Title"] = "Confirm Publish";
}

@section BreadCrumb{
    <div class="breadcrumbs">
        <ol>
            <li><a href="~/">@BreadcrumbText.CalculateFunding</a></li>
            <li><a href="/approvals">@BreadcrumbText.FundingApprovals</a></li>
            <li><a href="/approvals/viewfunding">@BreadcrumbText.ApproveAndPublishFunding</a></li>
            <li>@BreadcrumbText.ConfirmPublish</li>
        </ol>
    </div>
}

@section BannerLeft{
    <h1 class="hero-title">Publish confirmation for the selected provider funding</h1>
}

<div class="confirmpublish-page-container" id="confirmpublish-page-container">
    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <span class="error-message">@Model.ErrorMessage</span>

    }
    else
    {
        <div class="confirmpublish-details">
            <div class="confirmpublish-details-providers">
                <table>
                    <caption>You have selected:</caption>
                    <thead>
                        <tr>
                            <th class="fixed-width-300">Provider details</th>
                            <th>Info</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Number of providers to publish</td>
                            <td>@Model.ConfirmationDetails.NumberOfProviders</td>
                        </tr>
                        <tr>
                            <td>Provider types selected</td>
                            <td>
                                @if (Model.ConfirmationDetails.NumberOfProviders == 0)
                                {
                                    <span>None</span>
                                }
                                else
                                {
                                    @Html.Raw(string.Join(", ", Model.ConfirmationDetails.ProviderTypes))
                                }
                            </td>
                        </tr>
                        <tr>
                            <td>Provider local authorities selected</td>
                            <td>
                                @if (Model.ConfirmationDetails.NumberOfProviders == 0)
                                {
                                    <span>None</span>
                                }
                                else
                                {
                                    @Html.Raw(string.Join(", ", Model.ConfirmationDetails.LocalAuthorities))
                                }
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="confirmpublish-details-specification">
                <table>
                    <thead>
                        <tr>
                            <th class="fixed-width-300">Specification Details</th>
                            <th>Info</th>
                            <th>Funding</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Funding Period</td>
                            <td colspan="2">
                                @if (Model.ConfirmationDetails.NumberOfProviders == 0)
                                {
                                    <span>None</span>
                                }
                                else
                                {
                                    @Model.ConfirmationDetails.FundingPeriod
                                }
                            </td>
                        </tr>
                        <tr class="nobottomborder">
                            <td>Specification Selected</td>
                            <td colspan="2">@Model.ConfirmationDetails.SpecificationName</td>
                        </tr>
                        @for (int fsNum = 0; fsNum < Model.ConfirmationDetails.FundingStreams.Count; fsNum++)
                        {
                            <tr class="topborderonly">
                                <td>Funding Stream @(fsNum + 1)</td>
                                <td colspan="2">@Model.ConfirmationDetails.FundingStreams[fsNum].Name</td>
                            </tr>
                            <tr class="nobottomborder">
                                <td class="allocation-line-text">Allocation Lines</td>
                                <td>
                                    @foreach (var allocationLine in @Model.ConfirmationDetails.FundingStreams[fsNum].AllocationLines)
                                    {
                                        <span class="allocation-line-text">@allocationLine.Name</span>
                                    }
                                </td>
                                <td>
                                    @foreach (var allocationLine in @Model.ConfirmationDetails.FundingStreams[fsNum].AllocationLines)
                                    {
                                        <span class="bold">@allocationLine.Value</span>
                                    }
                                </td>
                            </tr>

                        }
                        <tr class="topborderonly">
                            <td><span class="bold">Total Funding being published</span></td>
                            <td></td>
                            <td>
                                <span class="bold">@Model.ConfirmationDetails.TotalFundingApproved</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="confirmpublish-confirmation">
            <span>Once Published:</span>
            <ol>
                <li>Funding values will be available to the profiling service</li>
                <li>Funding values <strong>will be</strong> available for providers to view via the ESFS</li>
                <li>Funding values will be available to the payment service to be paid on the schedule date</li>
            </ol>
            <div class="confirmpublish-warning">
                <div class="confirmpublishwarning-icon">
                    <i class="material-icons">error</i>
                </div>
                <div>
                    <strong>Published funding values can change when data or calculatations are altered. If the funding values change their statuses will become 'updated' and they will need to be reapproved and republished.</strong>
                </div>
            </div>
            <div class="confirmpublish-buttons">
                <button id="publish" class="button approvalstatus-button approvalstatus-button-approve">Confirm publish</button>
                <a href="/approvals/viewfunding">Back</a>
                <span id="wait-state-container" style="display:none"><img src="~/assets/images/loader.gif" /> Publishing items</span>
            </div>
        </div>
    }
</div>

@section scripts{
    <script type="text/javascript" asp-src-include="~/assets/libs/js/knockout-latest.js" asp-append-version="true"></script>
    <script type="text/javascript" asp-src-include="~/js/approvals.confirm.js" asp-append-version="true"></script>

    <script type="text/javascript">
        var setPublishedStatusUrl = "/api/specs/@Model.SpecificationId/allocationlineapprovalstatus";
        var viewFundingUrl = "/approvals/viewfunding";
        var updateModelJson = '@Html.Raw(Model.UpdateStatusModelJson)';
        var antiforgeryToken = '@this.HttpContext.GetAntiforgeryToken()';

    </script>
}